# 功能规格：模块列表管理

## 1. 数据上下文
- **存储：** `useStationStore` (Pinia)。
- **状态来源：** `store.plannedModules` (对象数组)。
- **数据结构：**
  ```typescript
  interface SavedModule {
    id: string;   // 模块ID (例如 'prod_energycells')
    count: number;// 用户定义的数量
  }
  ```

## 2. 交互逻辑

### A. 列表管理 (CRUD)
- **渲染列表：** 垂直分为三个独立区域展示，区域之间有明显分隔符。
  1. **手动规划区 (Manual):** 仅显示用户明确添加的模块。
  2. **自动产线区 (Auto-Industry):** 显示为了满足原料缺口而自动生成的模块。
  3. **补给产区 (Auto-Supply):** 显示为了满足劳动力消耗而生成的食品/医疗模块。
- **重新排序 (拖放)**：
  - 必须使用 `vuedraggable` 库。
  - **限制：** 仅 "手动规划区" 支持拖拽排序。自动区模块按照固定规则（如字母序或产线层级）排序。
- **删除模块**：
  - 触发：点击 '×' 按钮。
  - **手动区：** 直接移除。
  - **自动区：** 不可直接删除（它们是由缺口计算出来的）。点击数量或特定交互可将其"晋升(Promote)"为手动模块。

### B. 输入处理
- **数量更新**：
  - 组件：X4NumberInput。
  - 限制：最小值 = 1。
  - **手动区：** 更新 `store.manualModules[index].count`。
  - **自动区：** 没有直接数量输入框。点击数量可将其"晋升(Promote)"为手动模块。
- **日照设置**：
  - 范围：全局站点设置。
  - 绑定：`store.settings.sunlight`。
  - 效果：直接影响计算器引擎中的能量电池产量输出。

### C. 自动化功能
  - 行为：点击结果会将新模块追加到 **手动规划区**，数量为 1。
- **响应式自动补全**：
  - **触发机制：** 不再通过按钮手动触发。当 `manualModules` 发生变化或资源锁状态改变时，系统自动重算。
  - **锁控制 (Locking)**：
    - 资源的"锁"状态（在中间产出面板操作）决定是否为其自动补全上游产线。
    - **逻辑：** 若某资源未锁且存在缺口 -> 系统在自动区添加对应工厂。
  - **配置项 (Settings)**：
    - `globalWorkforceBonus`: 全局劳动力加成开关（影响手动区和自动产线区）。
    - `supplyWorkforceBonus`: **补给区独立加成开关**。默认关闭，以防止工人需求的循环依赖。

## 3. 组件通信
- **Props**: StationModuleItem 接收特定项目和 moduleInfo。
- **Emits**: StationModuleItem 向父列表发出 `update:count` 和 `remove`。
- **视觉逻辑**:
  - **颜色条**: 居住模块 (`habitat`) 显示橙色 (`bg-orange-500`)；生产模块显示蓝色 (`bg-sky-500`)。